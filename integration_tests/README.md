# MaiBot å¤šç§Ÿæˆ·é›†æˆæµ‹è¯•

æ¨¡ä»¿ mock_client æ¶æ„ï¼Œä½¿ç”¨ LLM æ„é€ çœŸå®åœºæ™¯çš„å¤šç§Ÿæˆ·å¤šagentæµ‹è¯•æ¶ˆæ¯ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¢ **å¤šç§Ÿæˆ·æ”¯æŒ**: æ¨¡æ‹Ÿå¤šä¸ªç‹¬ç«‹ç§Ÿæˆ·çš„åœºæ™¯
- ğŸ¤– **å¤šæ™ºèƒ½ä½“æµ‹è¯•**: æ”¯æŒä¸åŒæ€§æ ¼å’ŒåŠŸèƒ½çš„æ™ºèƒ½ä½“
- ğŸŒ **å¤šå¹³å°è¦†ç›–**: æ”¯æŒQQã€å¾®ä¿¡ã€Discordç­‰å¹³å°
- ğŸ”„ **å¹¶å‘æµ‹è¯•**: æ”¯æŒé«˜å¹¶å‘æ¶ˆæ¯å‘é€æµ‹è¯•
- ğŸ¤– **LLMé©±åŠ¨**: ä½¿ç”¨LLMç”ŸæˆçœŸå®çš„æµ‹è¯•æ¶ˆæ¯
- ğŸ“Š **è¯¦ç»†æŠ¥å‘Š**: ç”Ÿæˆå®Œæ•´çš„æµ‹è¯•æŠ¥å‘Šå’Œç»Ÿè®¡æ•°æ®

## æ¶æ„è®¾è®¡

```
integration_tests/
â”œâ”€â”€ __init__.py          # æ¨¡å—åˆå§‹åŒ–
â”œâ”€â”€ config.py            # é…ç½®ç®¡ç†
â”œâ”€â”€ message_generator.py # LLMæ¶ˆæ¯ç”Ÿæˆå™¨
â”œâ”€â”€ client.py            # å¤šç§Ÿæˆ·æµ‹è¯•å®¢æˆ·ç«¯
â”œâ”€â”€ main.py              # å‘½ä»¤è¡Œå…¥å£
â”œâ”€â”€ test_config.toml     # é»˜è®¤æµ‹è¯•é…ç½®
â””â”€â”€ README.md           # è¯´æ˜æ–‡æ¡£
```

## å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºé…ç½®æ–‡ä»¶

```bash
# åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶
python -m integration_tests.main --create-config my_config.toml
```

### 2. è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python -m integration_tests.main

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
python -m integration_tests.main --config my_config.toml

# è¿è¡Œå¹¶å‘æµ‹è¯•
python -m integration_tests.main --mode concurrent --concurrent-users 10

# åªè¿è¡Œåœºæ™¯æµ‹è¯•
python -m integration_tests.main --mode scenarios
```

### 3. æŸ¥çœ‹ç»“æœ

æµ‹è¯•å®Œæˆåä¼šæ˜¾ç¤ºè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šï¼ŒåŒ…æ‹¬ï¼š
- æ€»ä½“ç»Ÿè®¡ä¿¡æ¯
- å„åœºæ™¯çš„è¯¦ç»†ç»“æœ
- æˆåŠŸç‡å’Œé”™è¯¯ä¿¡æ¯
- æ€§èƒ½æŒ‡æ ‡

## é…ç½®è¯´æ˜

### åŸºæœ¬é…ç½®

```toml
[settings]
concurrent_users = 3          # å¹¶å‘ç”¨æˆ·æ•°
message_delay_min = 0.5       # æ¶ˆæ¯å»¶è¿Ÿæœ€å°å€¼(ç§’)
message_delay_max = 2.0       # æ¶ˆæ¯å»¶è¿Ÿæœ€å¤§å€¼(ç§’)
test_duration = 600           # æµ‹è¯•æŒç»­æ—¶é—´(ç§’)
log_level = "INFO"            # æ—¥å¿—çº§åˆ«
```

### LLMé…ç½®

```toml
[llm]
model_name = "gpt-3.5-turbo"  # LLMæ¨¡å‹åç§°
api_base = "null"             # APIåŸºç¡€URL
api_key = "null"              # APIå¯†é’¥
temperature = 0.8             # ç”Ÿæˆæ¸©åº¦
max_tokens = 200              # æœ€å¤§ä»¤ç‰Œæ•°
timeout = 30.0                # è¶…æ—¶æ—¶é—´
```

### ç§Ÿæˆ·é…ç½®

```toml
[[tenants]]
tenant_id = "tenant_a"        # ç§Ÿæˆ·ID
tenant_name = "ç§‘æŠ€å…¬å¸A"     # ç§Ÿæˆ·åç§°
description = "..."           # ç§Ÿæˆ·æè¿°

[tenants.settings]
industry = "technology"       # è¡Œä¸šç±»å‹
size = "medium"               # è§„æ¨¡å¤§å°
```

### æ™ºèƒ½ä½“é…ç½®

```toml
[[agents]]
agent_id = "assistant_tech"   # æ™ºèƒ½ä½“ID
agent_name = "æŠ€æœ¯åŠ©æ‰‹"       # æ™ºèƒ½ä½“åç§°
personality = "ä¸“ä¸šã€ä¸¥è°¨"    # æ€§æ ¼ç‰¹å¾
tenant_id = "tenant_a"        # æ‰€å±ç§Ÿæˆ·
description = "..."           # æ™ºèƒ½ä½“æè¿°
```

### æµ‹è¯•åœºæ™¯é…ç½®

```toml
[[scenarios]]
name = "æŠ€æœ¯è®¨è®ºç¾¤"           # åœºæ™¯åç§°
description = "..."           # åœºæ™¯æè¿°
tenant_id = "tenant_a"        # ç§Ÿæˆ·ID
agent_id = "assistant_tech"   # æ™ºèƒ½ä½“ID
platform = "qq"               # å¹³å°
user_id = "dev_001"           # ç”¨æˆ·ID
group_id = "tech_group_001"   # ç¾¤ç»„ID(å¯é€‰)
message_count = 15            # æ¶ˆæ¯æ•°é‡
conversation_topics = ["Pythonç¼–ç¨‹", "ç®—æ³•ä¼˜åŒ–"]  # å¯¹è¯ä¸»é¢˜
```

## æµ‹è¯•æ¨¡å¼

### 1. å®Œæ•´æµ‹è¯• (all)
è¿è¡Œæ‰€æœ‰åœºæ™¯æµ‹è¯•å’Œå¹¶å‘æµ‹è¯•

```bash
python -m integration_tests.main --mode all
```

### 2. åœºæ™¯æµ‹è¯• (scenarios)
åªè¿è¡Œé¢„å®šä¹‰çš„åœºæ™¯æµ‹è¯•

```bash
python -m integration_tests.main --mode scenarios
```

### 3. å¹¶å‘æµ‹è¯• (concurrent)
è¿è¡Œé«˜å¹¶å‘æ¶ˆæ¯å‘é€æµ‹è¯•

```bash
python -m integration_tests.main --mode concurrent --concurrent-users 20
```

## å‘½ä»¤è¡Œé€‰é¡¹

```bash
é€‰é¡¹:
  --config PATH           é…ç½®æ–‡ä»¶è·¯å¾„
  --mode {all,scenarios,concurrent}
                         æµ‹è¯•æ¨¡å¼ (é»˜è®¤: all)
  --concurrent-users INT  å¹¶å‘ç”¨æˆ·æ•°
  --log-level {DEBUG,INFO,WARNING,ERROR}
                         æ—¥å¿—çº§åˆ« (é»˜è®¤: INFO)
  --create-config PATH    åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶
  --force                 å¼ºåˆ¶è¦†ç›–å·²å­˜åœ¨çš„é…ç½®æ–‡ä»¶
  --server-url URL        MaiBotæœåŠ¡å™¨URL
  --output PATH           ä¿å­˜æµ‹è¯•ç»“æœåˆ°æ–‡ä»¶
```

## é¢„å®šä¹‰æµ‹è¯•åœºæ™¯

### 1. æŠ€æœ¯è®¨è®ºç¾¤
- **ç§Ÿæˆ·**: ç§‘æŠ€å…¬å¸A
- **æ™ºèƒ½ä½“**: æŠ€æœ¯åŠ©æ‰‹
- **å¹³å°**: QQ
- **ä¸»é¢˜**: Pythonç¼–ç¨‹ã€ç®—æ³•ä¼˜åŒ–ã€ç³»ç»Ÿæ¶æ„ã€Bugè°ƒè¯•

### 2. ä¸€å¯¹ä¸€æ•™å­¦
- **ç§Ÿæˆ·**: æ•™è‚²æœºæ„B
- **æ™ºèƒ½ä½“**: æ•™è‚²å¯¼å¸ˆ
- **å¹³å°**: å¾®ä¿¡
- **ä¸»é¢˜**: æ•°å­¦é—®é¢˜ã€å­¦ä¹ æ–¹æ³•ã€ä½œä¸šè¾…å¯¼ã€è€ƒè¯•å‡†å¤‡

### 3. æ—¥å¸¸èŠå¤©
- **ç§Ÿæˆ·**: ä¸ªäººç”¨æˆ·C
- **æ™ºèƒ½ä½“**: é€šç”¨ä¼™ä¼´
- **å¹³å°**: Discord
- **ä¸»é¢˜**: ç”µå½±æ¨èã€å…´è¶£çˆ±å¥½ã€æ—¥å¸¸ç”Ÿæ´»ã€æ¸¸æˆè®¨è®º

## è¾“å‡ºç¤ºä¾‹

```
=== å¤šç§Ÿæˆ·é›†æˆæµ‹è¯•æŠ¥å‘Š ===
æµ‹è¯•æ—¶é—´: 2024-01-15 14:30:25
æµ‹è¯•åœºæ™¯æ•°: 3

=== æ€»ä½“ç»Ÿè®¡ ===
æ€»å‘é€æ¶ˆæ¯æ•°: 47
æ€»æ¥æ”¶æ¶ˆæ¯æ•°: 38
æ€»é”™è¯¯æ•°: 2
æ€»ä½“æˆåŠŸç‡: 80.85%

=== åœºæ™¯è¯¦æƒ… ===
åœºæ™¯: æŠ€æœ¯è®¨è®ºç¾¤
  ç§Ÿæˆ·: tenant_a
  æ™ºèƒ½ä½“: assistant_tech
  å¹³å°: qq
  å‘é€æ¶ˆæ¯: 15
  æ¥æ”¶æ¶ˆæ¯: 12
  æˆåŠŸç‡: 80.00%
  è€—æ—¶: 12.34ç§’

=== å…³é”®æŒ‡æ ‡ ===
å¹¶å‘ç”¨æˆ·æ•°: 3
æ€»æ¶ˆæ¯æ•°: 47
æˆåŠŸç‡: 80.85%
æ¶ˆæ¯é€Ÿç‡: 3.81 msg/s
æµ‹è¯•è€—æ—¶: 12.34 ç§’
```

## æ•…éšœæ’é™¤

### 1. LLMè¿æ¥å¤±è´¥
å¦‚æœLLM APIä¸å¯ç”¨ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨é¢„å®šä¹‰çš„æ¨¡æ‹Ÿæ¶ˆæ¯ã€‚

### 2. æœåŠ¡å™¨è¿æ¥å¤±è´¥
æ£€æŸ¥MaiBotæœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œä»¥åŠæœåŠ¡å™¨URLæ˜¯å¦æ­£ç¡®ã€‚

### 3. é…ç½®æ–‡ä»¶é”™è¯¯
ä½¿ç”¨ `--create-config` åˆ›å»ºæ­£ç¡®çš„é…ç½®æ–‡ä»¶æ¨¡æ¿ã€‚

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„æµ‹è¯•åœºæ™¯
åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ–°çš„ `[[scenarios]]` é…ç½®æ®µã€‚

### è‡ªå®šä¹‰æ¶ˆæ¯ç”Ÿæˆå™¨
ç»§æ‰¿ `LLMMessageGenerator` ç±»å¹¶é‡å†™ç›¸åº”æ–¹æ³•ã€‚

### æ·»åŠ æ–°çš„å¹³å°
åœ¨å¹³å°é…ç½®ä¸­æ·»åŠ æ–°çš„ `[[platforms]]` é…ç½®æ®µã€‚